////////////////////////////////////////////////////////
////////////////////////////////////////////////////////
// Things to do only once, not once per component
////////////////////////////////////////////////////////
////////////////////////////////////////////////////////

ACTION_IF !(VARIABLE_IS_SET "reserved_immutable_initialise") BEGIN

	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// WeiDU v247+ required
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	/*ACTION_IF ("%WEIDU_VER%" < 247) BEGIN
		FAIL "WeiDU v247+ required!"
	END*/

	//////////////////////////////////////////////////////////////
	/// If this is Siege of Dragonspear, then make sure DLC Merger
	/// is installed
	//////////////////////////////////////////////////////////////

	ACTION_IF ((FILE_EXISTS ~dlc/sod-dlc.zip~) OR (FILE_EXISTS ~sod-dlc.zip~)) BEGIN
		FAIL ~DLC Merger is required before mods can be installed on this game. Check the readme for more information and a link to download DLC Merger.~
	END

	CLEAR_EVERYTHING	// Make sure we get a fresh start

	SILENT
	OUTER_SET "reserved_immutable_initialise" = 1

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	//// Install our version of SFO (Luke Functional Overlay)
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	INCLUDE "pnp_potions/lfo/install_lfo.tph"

	//////////////////////////////////////////////////
	//// Load in any shared function libraries
	//////////////////////////////////////////////////

	INCLUDE "%mod_root%/lib/functions.tph"

	//////////////////////////////////////////////////
	//// Load in any shared IDS constants
	//////////////////////////////////////////////////

	ACTION_BASH_FOR "%mod_root%/lib/ids_constants" "^.+\.tph$" BEGIN
		INCLUDE "%BASH_FOR_FILESPEC%"
		ACTION_TO_UPPER "BASH_FOR_RES"
		LAM "%BASH_FOR_RES%_IDS"
	END

	//////////////////////////////////////////////////
	//// Load in any shared 2DA constants
	//////////////////////////////////////////////////

	ACTION_BASH_FOR "%mod_root%/lib/2da_constants" "^.+\.tph$" BEGIN
		INCLUDE "%BASH_FOR_FILESPEC%"
		ACTION_TO_UPPER "BASH_FOR_RES"
		LAM "%BASH_FOR_RES%_2DA"
	END

	//////////////////////////////////////////////////////////////
	/// Reload ~setup.tra~
	//////////////////////////////////////////////////////////////

	LOAD_TRA "%tra_loc%/%base_language%/%tra_setup%.tra" "%tra_loc%/%LANGUAGE%/%tra_setup%.tra"	// do this again just in case

	VERBOSE
	// PRINT "This code only runs once, even if you install lots of components"
END

////////////////////////////////////////////////////////////////////
///// Do this part again once per component (don't put things here
///// if you don't have to, but tra loadins need to go here to avoid
///// edge-case runtime errors)
////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////
////  Load in any shared tra files
//////////////////////////////////////////////////

LOAD_TRA "%tra_loc%/english/shared.tra" "%tra_loc%/%LANGUAGE%/shared.tra"